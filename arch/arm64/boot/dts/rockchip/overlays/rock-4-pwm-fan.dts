/dts-v1/;						
/plugin/;						

#include <dt-bindings/thermal/thermal.h>
#include <dt-bindings/interrupt-controller/arm-gic.h>
#include <dt-bindings/interrupt-controller/irq.h>

/* 	Add an external PWM fan to GPIO pin-11 GPIO4_C2	 (gpio-146) on
	ROCK 4SE & ROCK 4C+ boards
*/

&pwm0 {
    status = "okay";
};

&tsadc {
    /* remove cell 4
       see Documentation/devicetree/bindings/interrupt-controller/arm,gic-v3.yaml
    */
	interrupts = <GIC_SPI 97 IRQ_TYPE_LEVEL_HIGH>;
	rockchip,hw-tshut-mode = <1>;   /* tshut mode 0:CRU 1:GPIO */
	rockchip,hw-tshut-polarity = <1>;	/* tshut polarity 0:LOW 1:HIGH */
	rockchip,hw-tshut-temp = <110000>;
	status = "okay";
};

&{/} {
        fan0: pwm-fan {
            compatible = "pwm-fan";
            #cooling-cells = <2>;
            fan-supply = <&vcc5v0_sys>;            
            pwms = <&pwm0 0 40000 0>;
            cooling-levels = <0 255 255 255 255>;
        };
};
    
&soc_thermal {
	/* sustainable-power = <5000>; milliwatts */
	trips {
		fan_on: fan_on {
			temperature = <40000>;
			hysteresis = <2000>;
			type = "active";
		};
	};	

	cooling-maps {
		map3 {
			trip = <&fan_on>;
			cooling-device = <&fan0 2 THERMAL_NO_LIMIT>;
		};
	};
};

